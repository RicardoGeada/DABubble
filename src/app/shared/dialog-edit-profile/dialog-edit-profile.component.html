<form [formGroup]="editForm" (ngSubmit)="onSubmit()" class="form">

    <section class="show-profile-dialog"  (click)="closeAvatarDialog()">

        <div class="profile-head">
            <div class="profile-headline fs-24">Dein Profil bearbeiten</div>
            <button class="btn-icon w40" [mat-dialog-close]>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <mask id="mask0_813_12181" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="24"
                        height="24">
                        <rect width="24" height="24" fill="#D9D9D9" />
                    </mask>
                    <g mask="url(#mask0_813_12181)">
                        <path
                            d="M11.9998 13.4L7.0998 18.3C6.91647 18.4834 6.68314 18.575 6.3998 18.575C6.11647 18.575 5.88314 18.4834 5.6998 18.3C5.51647 18.1167 5.4248 17.8834 5.4248 17.6C5.4248 17.3167 5.51647 17.0834 5.6998 16.9L10.5998 12L5.6998 7.10005C5.51647 6.91672 5.4248 6.68338 5.4248 6.40005C5.4248 6.11672 5.51647 5.88338 5.6998 5.70005C5.88314 5.51672 6.11647 5.42505 6.3998 5.42505C6.68314 5.42505 6.91647 5.51672 7.0998 5.70005L11.9998 10.6L16.8998 5.70005C17.0831 5.51672 17.3165 5.42505 17.5998 5.42505C17.8831 5.42505 18.1165 5.51672 18.2998 5.70005C18.4831 5.88338 18.5748 6.11672 18.5748 6.40005C18.5748 6.68338 18.4831 6.91672 18.2998 7.10005L13.3998 12L18.2998 16.9C18.4831 17.0834 18.5748 17.3167 18.5748 17.6C18.5748 17.8834 18.4831 18.1167 18.2998 18.3C18.1165 18.4834 17.8831 18.575 17.5998 18.575C17.3165 18.575 17.0831 18.4834 16.8998 18.3L11.9998 13.4Z"
                            fill="#1C1B1F" />
                    </g>
                </svg>
            </button>
        </div>

        <div class="img-container">
            @if (!changeAvatar){
            <img class="profile-img" [src]="thisAvatar" alt="Profile Image" (click)="openAvatarDialog(); $event.stopPropagation()" referrerpolicy="no-referrer" >
            }
            @if (changeAvatar){
            <img class="profile-img" [src]="thisAvatar" alt="Profile Image" (click)="$event.stopPropagation()">
            <div class="change-avatar"  (click)="$event.stopPropagation()">
                <div class="avatar-list">
                    <button type="button" (click)="changeUserAvatar(0)"><img src="assets/img/avatar-1.jpg" alt=""></button>
                    <button type="button" (click)="changeUserAvatar(1)"><img src="assets/img/avatar-2.jpg" alt=""></button>
                    <button type="button" (click)="changeUserAvatar(2)"><img src="assets/img/avatar-3.jpg" alt=""></button>
                    <button type="button" (click)="changeUserAvatar(3)"><img src="assets/img/avatar-4.jpg" alt=""></button>
                    <button type="button" (click)="changeUserAvatar(4)"><img src="assets/img/avatar-5.jpg" alt=""></button>
                    <button type="button" (click)="changeUserAvatar(5)"><img src="assets/img/avatar-6.jpg" alt=""></button>
                </div>
                <div class="j-left upload-container">
                    <input type="file" #fileInput style="display: none" (change)="uploadAvatar($event)">
                    <button type="button" (click)="fileInput.click()" class="btn-secondary fs-18">Bild Hochladen</button>
                </div>
            </div>
            }
        </div>

        <div class="editing-container">
            <div class="email-container">
                <div class="email">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <mask id="mask0_813_12108" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0"
                            width="24" height="24">
                            <rect width="24" height="24" fill="#D9D9D9" />
                        </mask>
                        <g mask="url(#mask0_813_12108)">
                            <path
                                d="M5.85 17.1C6.7 16.45 7.65 15.9373 8.7 15.562C9.75 15.1873 10.85 15 12 15C13.15 15 14.25 15.1873 15.3 15.562C16.35 15.9373 17.3 16.45 18.15 17.1C18.7333 16.4167 19.1877 15.6417 19.513 14.775C19.8377 13.9083 20 12.9833 20 12C20 9.78333 19.221 7.89567 17.663 6.337C16.1043 4.779 14.2167 4 12 4C9.78333 4 7.896 4.779 6.338 6.337C4.77933 7.89567 4 9.78333 4 12C4 12.9833 4.16267 13.9083 4.488 14.775C4.81267 15.6417 5.26667 16.4167 5.85 17.1ZM12 13C11.0167 13 10.1873 12.6627 9.512 11.988C8.83733 11.3127 8.5 10.4833 8.5 9.5C8.5 8.51667 8.83733 7.68733 9.512 7.012C10.1873 6.33733 11.0167 6 12 6C12.9833 6 13.8127 6.33733 14.488 7.012C15.1627 7.68733 15.5 8.51667 15.5 9.5C15.5 10.4833 15.1627 11.3127 14.488 11.988C13.8127 12.6627 12.9833 13 12 13ZM12 22C10.6167 22 9.31667 21.7373 8.1 21.212C6.88333 20.6873 5.825 19.975 4.925 19.075C4.025 18.175 3.31267 17.1167 2.788 15.9C2.26267 14.6833 2 13.3833 2 12C2 10.6167 2.26267 9.31667 2.788 8.1C3.31267 6.88333 4.025 5.825 4.925 4.925C5.825 4.025 6.88333 3.31233 8.1 2.787C9.31667 2.26233 10.6167 2 12 2C13.3833 2 14.6833 2.26233 15.9 2.787C17.1167 3.31233 18.175 4.025 19.075 4.925C19.975 5.825 20.6873 6.88333 21.212 8.1C21.7373 9.31667 22 10.6167 22 12C22 13.3833 21.7373 14.6833 21.212 15.9C20.6873 17.1167 19.975 18.175 19.075 19.075C18.175 19.975 17.1167 20.6873 15.9 21.212C14.6833 21.7373 13.3833 22 12 22ZM12 20C12.8833 20 13.7167 19.871 14.5 19.613C15.2833 19.3543 16 18.9833 16.65 18.5C16 18.0167 15.2833 17.6457 14.5 17.387C13.7167 17.129 12.8833 17 12 17C11.1167 17 10.2833 17.129 9.5 17.387C8.71667 17.6457 8 18.0167 7.35 18.5C8 18.9833 8.71667 19.3543 9.5 19.613C10.2833 19.871 11.1167 20 12 20ZM12 11C12.4333 11 12.7917 10.8583 13.075 10.575C13.3583 10.2917 13.5 9.93333 13.5 9.5C13.5 9.06667 13.3583 8.70833 13.075 8.425C12.7917 8.14167 12.4333 8 12 8C11.5667 8 11.2083 8.14167 10.925 8.425C10.6417 8.70833 10.5 9.06667 10.5 9.5C10.5 9.93333 10.6417 10.2917 10.925 10.575C11.2083 10.8583 11.5667 11 12 11Z"
                                fill="black" />
                        </g>
                    </svg>
                    <div class="email-label fs-20">Vollständiger Name</div>
                </div>
                <div class="input-field fs-18 change-name">
                    <input #name class="change-name" type="text" formControlName="name" [placeholder]="userService.currentUser?.name">
                </div>
            </div>

            <div class="email-container">
                <div class="email">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <mask id="mask0_46969_1041" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0"
                            width="24" height="24">
                            <rect width="24" height="24" fill="#D9D9D9" />
                        </mask>
                        <g mask="url(#mask0_46969_1041)">
                            <path
                                d="M4 20C3.45 20 2.97933 19.8043 2.588 19.413C2.196 19.021 2 18.55 2 18V6C2 5.45 2.196 4.97933 2.588 4.588C2.97933 4.196 3.45 4 4 4H20C20.55 4 21.021 4.196 21.413 4.588C21.8043 4.97933 22 5.45 22 6V18C22 18.55 21.8043 19.021 21.413 19.413C21.021 19.8043 20.55 20 20 20H4ZM20 8L12.525 12.675C12.4417 12.725 12.354 12.7623 12.262 12.787C12.1707 12.8123 12.0833 12.825 12 12.825C11.9167 12.825 11.8293 12.8123 11.738 12.787C11.646 12.7623 11.5583 12.725 11.475 12.675L4 8V18H20V8ZM12 11L20 6H4L12 11ZM4 8.25V6.775V6.8V6.787V8.25Z"
                                fill="#686868" />
                        </g>
                    </svg>
                    <div class="email-label fs-20">E-Mail-Adresse</div>
                </div>

                <div class="input-field fs-18">
                    <input #email type="email" formControlName="email" [placeholder]="emailPlaceholder()">
                </div>
                @if(email.value != userService.currentUser.email) {
                <p class="info">
                    Die Änderung deiner Email-Adresse muss verifiziert werden.<br>
                    Hierfür senden wir dir nach der Bestätigung einen Link an deine neue Email-Adresse.
                    @if(changeFromGmail()) {
                        <br>Ändere im Anschluss das Passwort wenn du von Login mit Google wechselst.
                    }
                </p>    
                }
                @if (emailExists) {
                <p class="errorMsg">Email existiert bereits</p>
                }
            </div>
        </div>

        <div class="btn-wrapper">
            <button class="btn-secondary fs-18" [mat-dialog-close]>
                Abbrechen
            </button>
            <button type="submit" class="btn-primary fs-18" [disabled]="!editForm.valid || ((name.value == userService.currentUser.name) && (email.value == userService.currentUser.email) && (!imageChanged))">
                Speichern
            </button>
        </div>
    </section>
</form>